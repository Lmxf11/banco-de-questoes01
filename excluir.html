<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Excluir Questões</title>

  <link rel="icon" type="image/png" href="imagem.jpeg">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
* {
  box-sizing: border-box;
  font-family: 'Inter', sans-serif;
}

body {
  margin: 0;
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  background: radial-gradient(circle at top left,#1e3a8a,#2563eb);
  color: #e0e7ff;
}

.container {
  width: 100%;
  max-width: 600px;
  padding: 36px;
}

h1 {
  text-align: center;
  margin-bottom: 26px;
}

.card {
  background: rgba(255,255,255,0.1);
  border-radius: 18px;
  padding: 22px;
  margin-bottom: 18px;
}

select {
  width: 100%;
  padding: 14px;
  border-radius: 14px;
  background: rgba(255,255,255,0.15);
  color: #fff;
  border: none;
}

select:disabled {
  opacity: 0.5;
}

button {
  padding: 14px;
  border-radius: 14px;
  border: none;
  cursor: pointer;
  font-weight: 700;
}

.actions {
  display: flex;
  gap: 12px;
}

#lista .card button {
  background: #dc2626;
  color: #fff;
}
</style>
</head>

<body>

<div class="container">

<h1>Excluir Questões</h1>

<div class="card">
  <select id="materia">
    <option value="">Escolha a matéria</option>
    <option value="Matemática">Matemática</option>
    <option value="Português">Português</option>
    <option value="Inglês">Inglês</option>
    <option value="Física">Física</option>
    <option value="Química">Química</option>
    <option value="Biologia">Biologia</option>
  </select>
</div>

<div class="card">
  <select id="area" disabled>
    <option value="">Escolha a área</option>
  </select>
</div>

<div class="card">
  <select id="assunto" disabled>
    <option value="">Escolha o assunto</option>
  </select>
</div>

<div class="actions">
  <button id="btnFiltrar">Buscar</button>
  <button onclick="history.back()">Voltar</button>
</div>

<div id="lista"></div>

</div>

<script>
const supabaseClient = supabase.createClient(
  "https://jsmdszcfgvoczkyfzzvu.supabase.co",
  "SUA_ANON_KEY_AQUI"
)

const materia = document.getElementById('materia')
const area = document.getElementById('area')
const assunto = document.getElementById('assunto')
const lista = document.getElementById('lista')

const materiasMap = {
  "Matemática": {
    areas: ["Aritmética","Álgebra"],
    assuntos: {
      "Aritmética": ["Porcentagem","Regra de três","Frações"],
      "Álgebra": ["Equação do 1º grau","Equação do 2º grau"]
    }
  },
  "Português": {
    areas: ["Ortografia","Sintaxe"],
    assuntos: {
      "Ortografia": ["Acentuação","Uso do hífen"],
      "Sintaxe": ["Sujeito","Predicado"]
    }
  }
}

/* MATÉRIA → ÁREA */
materia.addEventListener('change', () => {
  area.innerHTML = '<option value="">Escolha a área</option>'
  assunto.innerHTML = '<option value="">Escolha o assunto</option>'
  area.disabled = true
  assunto.disabled = true

  if (!materia.value) return

  area.disabled = false
  materiasMap[materia.value].areas.forEach(a => {
    area.innerHTML += `<option value="${a}">${a}</option>`
  })
})

/* ÁREA → ASSUNTO */
area.addEventListener('change', () => {
  assunto.innerHTML = '<option value="">Escolha o assunto</option>'
  assunto.disabled = true

  if (!area.value) return

  assunto.disabled = false
  materiasMap[materia.value].assuntos[area.value].forEach(a => {
    assunto.innerHTML += `<option value="${a}">${a}</option>`
  })
})

/* FILTRAR */
document.getElementById('btnFiltrar').onclick = async () => {
  lista.innerHTML = '<div class="card">Carregando...</div>'

  let query = supabaseClient
    .from('questoes')
    .select('id, enunciado, materia, assunto')

  if (materia.value) query = query.eq('materia', materia.value)
  if (assunto.value) query = query.eq('assunto', assunto.value)

  const { data } = await query
  lista.innerHTML = ''

  if (!data || data.length === 0) {
    lista.innerHTML = '<div class="card">Nenhuma questão encontrada</div>'
    return
  }

  data.forEach(q => {
    lista.innerHTML += `
      <div class="card">
        <p><strong>${q.materia} — ${q.assunto}</strong><br><br>${q.enunciado}</p>
        <button onclick="excluirQuestao('${q.id}')">Excluir</button>
      </div>
    `
  })
}

async function excluirQuestao(id) {
  if (!confirm('Deseja excluir?')) return
  await supabaseClient.from('questoes').delete().eq('id', id)
  document.getElementById('btnFiltrar').click()
}
</script>

</body>
</html>
