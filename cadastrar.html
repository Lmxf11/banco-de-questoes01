<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Cadastrar Questão</title>

<link rel="icon" type="image/png" href="imagem.jpeg">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
* {
  box-sizing: border-box;
  font-family: 'Inter', sans-serif;
}

body {
  margin: 0;
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;

  background: radial-gradient(
    circle at top left,
    #1e3a8a 0%,
    #1e40af 35%,
    #1d4ed8 70%,
    #2563eb 100%
  );

  color: #e0e7ff;
}

.container {
  width: 100%;
  max-width: 600px;
  padding: 36px;
  display: none;
}

h1 {
  text-align: center;
  margin-bottom: 26px;
  font-size: 28px;
  font-weight: 700;
}

.card {
  background: linear-gradient(
    160deg,
    rgba(255,255,255,0.10),
    rgba(255,255,255,0.04)
  );
  border-radius: 22px;
  border: 1px solid rgba(255,255,255,0.18);
  padding: 24px;
  backdrop-filter: blur(14px);
  box-shadow: 0 30px 60px rgba(0,0,0,0.35);
}

input, textarea, select {
  width: 100%;
  padding: 14px 18px;
  margin-bottom: 16px;

  border-radius: 16px;
  border: 1px solid rgba(255,255,255,0.25);
  background: rgba(255,255,255,0.12);
  color: #e0e7ff;

  font-size: 14px;
  outline: none;
}

input::placeholder,
textarea::placeholder {
  color: #c7d2fe;
}

input:focus,
textarea:focus,
select:focus {
  border-color: #60a5fa;
  box-shadow: 0 0 0 4px rgba(96,165,250,0.35);
}

textarea {
  resize: vertical;
  min-height: 90px;
}

select {
  appearance: none;
  cursor: pointer;
  background-image:
    linear-gradient(45deg, transparent 50%, #c7d2fe 50%),
    linear-gradient(135deg, #c7d2fe 50%, transparent 50%);
  background-position:
    calc(100% - 22px) 50%,
    calc(100% - 16px) 50%;
  background-size: 6px 6px;
  background-repeat: no-repeat;
}

select:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

button {
  width: 100%;
  padding: 14px;
  border-radius: 16px;
  border: none;
  background: linear-gradient(135deg, #3b82f6, #2563eb);
  color: #fff;
  font-weight: 700;
  cursor: pointer;
}

.msg {
  margin-top: 12px;
  text-align: center;
  font-weight: 600;
}

.floating-logo {
  position: fixed;
  bottom: 24px;
  right: 24px;
  width: 68px;
  height: 68px;
  border-radius: 50%;
  object-fit: cover;
  background: #fff;
  padding: 4px;
  box-shadow: 0 12px 30px rgba(0,0,0,0.35);
}
</style>
</head>

<body>

<img src="imagem.jpeg" alt="Logo" class="floating-logo">

<div class="container" id="app">
  <h1>Cadastrar Questão</h1>

  <div class="card">
    <form id="form">

      <select id="materia" required>
        <option value="">Escolha a matéria</option>
        <option value="Matemática">Matemática</option>
        <option value="Português">Português</option>
        <option value="Inglês">Inglês</option>
        <option value="Física">Física</option>
        <option value="Química">Química</option>
        <option value="Biologia">Biologia</option>
      </select>

      <select id="area" disabled>
        <option value="">Escolha a área</option>
      </select>

      <select id="assunto" disabled>
        <option value="">Escolha o assunto</option>
      </select>

      <textarea id="enunciado" placeholder="Enunciado da questão" required></textarea>

      <input id="a" placeholder="Alternativa A" required>
      <input id="b" placeholder="Alternativa B" required>
      <input id="c" placeholder="Alternativa C" required>
      <input id="d" placeholder="Alternativa D" required>
      <input id="e" placeholder="Alternativa E" required>

      <input id="correta" placeholder="Correta (A, B, C, D ou E)" maxlength="1" required>

      <button type="submit">Salvar questão</button>
      <div class="msg" id="msg"></div>

    </form>
  </div>
</div>

<script>
const supabaseClient = supabase.createClient(
  'https://jsmdszcfgvoczkyfzzvu.supabase.co',
  'sb_publishable_rqDGnUB-2tHkU4cNz1kRSg_oYRssJLn'
)

const materia = document.getElementById('materia')
const area = document.getElementById('area')
const assunto = document.getElementById('assunto')
const msg = document.getElementById('msg')

const materiasMap = {
  "Matemática": { areas: ["Aritmética","Álgebra","Geometria"], assuntos: { "Aritmética": ["Porcentagem","Regra de três"], "Álgebra": ["Equações"], "Geometria": ["Ângulos"] } },
  "Português": { areas: ["Ortografia","Sintaxe"], assuntos: { "Ortografia": ["Acentuação"], "Sintaxe": ["Concordância"] } },
  "Inglês": { areas: ["Grammar"], assuntos: { "Grammar": ["Verb to be"] } },
  "Física": { areas: ["Cinemática"], assuntos: { "Cinemática": ["MRU"] } },
  "Química": { areas: ["Química Geral"], assuntos: { "Química Geral": ["Átomo"] } },
  "Biologia": { areas: ["Citologia"], assuntos: { "Citologia": ["Célula"] } }
}

function resetSelect(sel, text) {
  sel.innerHTML = `<option value="">${text}</option>`
  sel.disabled = true
}

materia.addEventListener('change', () => {
  resetSelect(area, 'Escolha a área')
  resetSelect(assunto, 'Escolha o assunto')

  if (!materia.value) return

  area.disabled = false
  materiasMap[materia.value].areas.forEach(a => {
    area.innerHTML += `<option value="${a}">${a}</option>`
  })
})

area.addEventListener('change', () => {
  resetSelect(assunto, 'Escolha o assunto')
  if (!area.value) return

  assunto.disabled = false
  materiasMap[materia.value].assuntos[area.value].forEach(a => {
    assunto.innerHTML += `<option value="${a}">${a}</option>`
  })
})

document.getElementById('form').addEventListener('submit', async e => {
  e.preventDefault()

  const correta = document.getElementById('correta').value.toUpperCase()
  if (!['A','B','C','D','E'].includes(correta)) {
    msg.style.color = '#ef4444'
    msg.innerText = 'A alternativa correta deve ser A, B, C, D ou E.'
    return
  }

  const { error } = await supabaseClient.from('questoes').insert({
    materia: materia.value,
    area: area.value,
    assunto: assunto.value,
    enunciado: enunciado.value,
    alternativa_a: a.value,
    alternativa_b: b.value,
    alternativa_c: c.value,
    alternativa_d: d.value,
    alternativa_e: e.value,
    correta
  })

  if (error) {
    msg.style.color = '#ef4444'
    msg.innerText = 'Erro ao salvar questão.'
    return
  }

  msg.style.color = '#16a34a'
  msg.innerText = 'Questão cadastrada com sucesso!'
  document.getElementById('form').reset()
  resetSelect(area, 'Escolha a área')
  resetSelect(assunto, 'Escolha o assunto')
})

;(async () => {
  const { data: { user } } = await supabaseClient.auth.getUser()
  if (!user) return location.href = 'login.html'

  const { data } = await supabaseClient.from('users').select('role').eq('id', user.id).single()
  if (!data || data.role !== 'admin') return location.href = 'dashboard.html'

  document.getElementById('app').style.display = 'block'
})()
</script>

</body>
</html>
